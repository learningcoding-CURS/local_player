# è¿è¡Œæ—¥å¿—è¯´æ˜

## ğŸ“‹ æ‚¨æä¾›çš„æ—¥å¿—åˆ†æ

æ ¹æ®æ‚¨æä¾›çš„è¿è¡Œæ—¥å¿—ï¼Œä»¥ä¸‹æ˜¯å¯¹å„ç§æ—¥å¿—ä¿¡æ¯çš„è¯¦ç»†è¯´æ˜ï¼š

---

## âœ… æ­£å¸¸çš„æ—¥å¿—

ä»¥ä¸‹æ—¥å¿—è¡¨ç¤ºåº”ç”¨æ­£å¸¸è¿è¡Œï¼š

### 1. åº”ç”¨ç”Ÿå‘½å‘¨æœŸ
```
AppNavigation: Lifecycle ON_RESUME - resuming if needed
AppNavigation: Lifecycle ON_PAUSE - pausing playback
AppNavigation: Lifecycle ON_STOP - stopping playback
```
**è¯´æ˜**ï¼šåº”ç”¨æ­£ç¡®å¤„ç†ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨åå°æ—¶æš‚åœæ’­æ”¾ï¼Œåœ¨å‰å°æ—¶æ¢å¤æ’­æ”¾ã€‚è¿™æ˜¯æ­£ç¡®çš„è¡Œä¸ºã€‚

### 2. åª’ä½“ç‚¹å‡»å’ŒåŠ è½½
```
AppNavigation: Media item clicked: ã€Šæ„å»ºæ•…äº‹çš„æ¸è¿›è¿›å±•è¿‡ç¨‹ã€‹.wav
AppNavigation: Loading media item: 1
```
**è¯´æ˜**ï¼šç”¨æˆ·ç‚¹å‡»äº†åª’ä½“æ–‡ä»¶ï¼Œåº”ç”¨æ­£åœ¨åŠ è½½ã€‚åŠŸèƒ½æ­£å¸¸ã€‚

### 3. ExoPlayer åˆå§‹åŒ–
```
ExoPlayerManager: Player is null, reinitializing...
ExoPlayerImpl: Init b6cafca [AndroidXMedia3/1.2.0]
ExoPlayerManager: Player initialized successfully
```
**è¯´æ˜**ï¼šæ’­æ”¾å™¨æ­£ç¡®åˆå§‹åŒ–ï¼Œä½¿ç”¨ Media3 1.2.0 ç‰ˆæœ¬ã€‚

### 4. åª’ä½“åŠ è½½æˆåŠŸ
```
ExoPlayerManager: Media loaded: content://com.android.providers.downloads.documents/document/...
```
**è¯´æ˜**ï¼šéŸ³é¢‘æ–‡ä»¶é€šè¿‡ Storage Access Framework (SAF) æˆåŠŸåŠ è½½ã€‚

### 5. éŸ³é¢‘ç³»ç»Ÿ
```
AudioSystem: onNewService: media.audio_policy service obtained
AudioSystem: onNewServiceWithAdapter: media.audio_flinger service obtained
```
**è¯´æ˜**ï¼šAndroid éŸ³é¢‘ç³»ç»Ÿæ­£å¸¸åˆå§‹åŒ–ã€‚

---

## âš ï¸ è­¦å‘Šæ—¥å¿—ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰

### 1. attributionTag é”™è¯¯
```
AppOps: attributionTag not declared in manifest of com.local.mediaplayer
```
**å½±å“**ï¼šæ— å®é™…å½±å“ï¼Œåªæ˜¯ç³»ç»Ÿæ—¥å¿—è­¦å‘Š

**åŸå› **ï¼šAndroid 11+ å¼•å…¥çš„æ–°æœºåˆ¶ï¼Œç”¨äºè¿½è¸ªåº”ç”¨çš„æƒé™ä½¿ç”¨æƒ…å†µã€‚å½“åº”ç”¨è®¿é—®æ•æ„Ÿèµ„æºæ—¶ï¼Œç³»ç»ŸæœŸæœ›çœ‹åˆ° attribution tagï¼Œä½†è¿™ä¸æ˜¯å¿…éœ€çš„ã€‚

**æ˜¯å¦éœ€è¦ä¿®å¤**ï¼šä¸éœ€è¦ã€‚è¿™æ˜¯ Google Play Services å’Œç³»ç»ŸæœåŠ¡çš„å†…éƒ¨æ—¥å¿—ï¼Œä¸å½±å“åº”ç”¨åŠŸèƒ½ã€‚

**å¦‚æœæƒ³æ¶ˆé™¤è­¦å‘Š**ï¼šå¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨æƒé™æ—¶æ·»åŠ  attribution tagï¼Œä½†è¿™æ˜¯å¯é€‰çš„ï¼š
```kotlin
val context = context.createAttributionContext("media_access")
context.contentResolver.openInputStream(uri)
```

### 2. OnBackInvokedCallback è­¦å‘Š
```
WindowOnBackDispatcher: OnBackInvokedCallback is not enabled for the application.
Set 'android:enableOnBackInvokedCallback="true"' in the application manifest.
```
**å½±å“**ï¼šåœ¨ Android 13+ ä¸Šï¼Œè¿”å›é”®åŠ¨ç”»å¯èƒ½ä¸å¤Ÿæµç•…

**ä¿®å¤çŠ¶æ€**ï¼šâœ… å·²ä¿®å¤ï¼ˆv1.0.13ï¼‰

**ä¿®å¤æ–¹æ³•**ï¼šåœ¨ `AndroidManifest.xml` ä¸­æ·»åŠ ï¼š
```xml
android:enableOnBackInvokedCallback="true"
```

### 3. Image decoding logging dropped
```
HWUI: Image decoding logging dropped!
```
**å½±å“**ï¼šæ— å®é™…å½±å“

**åŸå› **ï¼šç³»ç»Ÿçš„å›¾å½¢æ¸²æŸ“æ—¥å¿—å› ä¸ºé¢‘ç‡è¿‡é«˜è¢«ä¸¢å¼ƒã€‚è¿™æ˜¯ HWUIï¼ˆHardware UIï¼‰çš„å†…éƒ¨ä¼˜åŒ–ï¼Œä¸å½±å“åº”ç”¨ã€‚

---

## âŒ é”™è¯¯æ—¥å¿—

### 1. SecurityException - URI æƒé™
```
System.err: Caused by: java.lang.SecurityException: Permission Denial: 
  reading com.android.providers.downloads.DownloadProvider uri...
```

**åŸå› **ï¼šå°è¯•è·å–æ–‡ä»¶çš„æŒä¹…åŒ– URI æƒé™å¤±è´¥

**è§¦å‘åœºæ™¯**ï¼šç”¨æˆ·é€šè¿‡æ–‡ä»¶é€‰æ‹©å™¨é€‰æ‹©æ–‡ä»¶åï¼Œåº”ç”¨å°è¯•è°ƒç”¨ `takePersistableUriPermission`

**å®é™…å½±å“**ï¼š
- âœ… æ–‡ä»¶ä»å¯è®¿é—®å’Œæ’­æ”¾ï¼ˆä½¿ç”¨ä¸´æ—¶æƒé™ï¼‰
- âŒ åº”ç”¨é‡å¯åå¯èƒ½æ— æ³•è®¿é—®è¯¥æ–‡ä»¶ï¼ˆæŒä¹…åŒ–æƒé™æœªè·å–ï¼‰

**ä¿®å¤çŠ¶æ€**ï¼šâœ… å·²ä¿®å¤ï¼ˆv1.0.13ï¼‰

**ä¿®å¤æ–¹æ³•**ï¼šæ·»åŠ å¼‚å¸¸å¤„ç†ï¼Œé™çº§ä½¿ç”¨ä¸´æ—¶æƒé™ï¼š
```kotlin
try {
    context.contentResolver.takePersistableUriPermission(uri, Intent.FLAG_GRANT_READ_URI_PERMISSION)
} catch (e: SecurityException) {
    // ä½¿ç”¨ä¸´æ—¶æƒé™ç»§ç»­
    Log.w("MediaList", "Cannot take persistable permission, using temporary")
}
```

---

## ğŸ” å…³é”®è§‚å¯Ÿ

### åŒ…åé—®é¢˜
æ‚¨çš„æ—¥å¿—æ˜¾ç¤ºï¼š
```
com.local.mediaplayer
```

ä½†ä»£ç å·²æ›´æ–°ä¸ºï¼š
```
com.localmedia.player
```

**ç»“è®º**ï¼šæ‚¨è¿è¡Œçš„æ˜¯æ—§ç‰ˆæœ¬çš„ APKï¼

### è§£å†³æ–¹æ¡ˆ
1. å¸è½½æ—§ç‰ˆæœ¬ï¼š`adb uninstall com.local.mediaplayer`
2. æ¸…ç†é¡¹ç›®ï¼š**Build â†’ Clean Project**
3. é‡æ–°æ„å»ºï¼š**Build â†’ Rebuild Project**
4. å®‰è£…æ–°ç‰ˆæœ¬

---

## ğŸ“Š æ—¥å¿—çº§åˆ«è¯´æ˜

### I (Info) - ä¿¡æ¯
æ­£å¸¸çš„è¿è¡ŒçŠ¶æ€ä¿¡æ¯ï¼Œæ— éœ€å…³æ³¨

### D (Debug) - è°ƒè¯•
å¼€å‘è€…æ·»åŠ çš„è°ƒè¯•ä¿¡æ¯ï¼Œå¸®åŠ©è¿½è¸ªåº”ç”¨è¡Œä¸º

### W (Warning) - è­¦å‘Š
å¯èƒ½çš„é—®é¢˜ï¼Œä½†ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½

### E (Error) - é”™è¯¯
å®é™…çš„é”™è¯¯ï¼Œå¯èƒ½å½±å“åŠŸèƒ½

---

## ğŸ¯ æ–°ç‰ˆæœ¬é¢„æœŸæ—¥å¿—

é‡æ–°æ„å»ºå¹¶å®‰è£… v1.0.13 åï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š

### âœ… åº”è¯¥çœ‹åˆ°
```
com.localmedia.player  (æ–°åŒ…å)
ExoPlayerManager: Player initialized successfully
ExoPlayerManager: Media loaded: content://...
AppNavigation: Lifecycle ON_RESUME
```

### âŒ ä¸åº”è¯¥çœ‹åˆ°
```
com.local.mediaplayer  (æ—§åŒ…å)
SecurityException: Permission Denial
OnBackInvokedCallback is not enabled
```

### âš ï¸ å¯èƒ½ä»ä¼šçœ‹åˆ°ï¼ˆæ— å®³ï¼‰
```
AppOps: attributionTag not declared in manifest
HWUI: Image decoding logging dropped!
```

---

## ğŸ› ï¸ è°ƒè¯•æŠ€å·§

### 1. è¿‡æ»¤æ—¥å¿—åªçœ‹åº”ç”¨è¾“å‡º
```bash
# æ—§åŒ…å
adb logcat | grep "com.local.mediaplayer"

# æ–°åŒ…å
adb logcat | grep "com.localmedia.player"
```

### 2. åªçœ‹é”™è¯¯å’Œè­¦å‘Š
```bash
adb logcat *:W
```

### 3. åªçœ‹ç‰¹å®šæ ‡ç­¾
```bash
adb logcat ExoPlayerManager:D *:S
adb logcat AppNavigation:D *:S
```

### 4. æ¸…ç©ºæ—¥å¿—ç¼“å†²åŒº
```bash
adb logcat -c
```

---

## ğŸ“ å¦‚ä½•æŠ¥å‘Šé—®é¢˜

å¦‚æœé‡åˆ°æ–°çš„é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. å®Œæ•´çš„ logcat è¾“å‡ºï¼ˆä»åº”ç”¨å¯åŠ¨åˆ°é”™è¯¯å‘ç”Ÿï¼‰
2. æ“ä½œæ­¥éª¤ï¼ˆå¦‚ä½•å¤ç°é—®é¢˜ï¼‰
3. è®¾å¤‡ä¿¡æ¯ï¼ˆå‹å·ã€Android ç‰ˆæœ¬ï¼‰
4. åº”ç”¨ç‰ˆæœ¬ï¼ˆæ£€æŸ¥åŒ…åæ˜¯å¦ä¸º `com.localmedia.player`ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-12-23  
**é€‚ç”¨äº**: æ’­æ”¾å™¨L2 v1.0.13+

