# æ¶æ„è®¾è®¡æ–‡æ¡£

## æ•´ä½“æ¶æ„

æœ¬åº”ç”¨é‡‡ç”¨ **MVVM + Repository** æ¶æ„æ¨¡å¼ï¼Œç»“åˆ Jetpack Compose è¿›è¡Œ UI å¼€å‘ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Presentation Layer                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Jetpack Compose UI                     â”‚   â”‚
â”‚  â”‚  - PlayerScreen                                  â”‚   â”‚
â”‚  â”‚  - MediaListScreen                               â”‚   â”‚
â”‚  â”‚  - Navigation                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â†•                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           ViewModel (Optional)                   â”‚   â”‚
â”‚  â”‚  - State Management                              â”‚   â”‚
â”‚  â”‚  - UI Logic                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Domain Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           ExoPlayerManager                       â”‚   â”‚
â”‚  â”‚  - æ’­æ”¾æ§åˆ¶                                       â”‚   â”‚
â”‚  â”‚  - å€é€Ÿç®¡ç†                                       â”‚   â”‚
â”‚  â”‚  - è¿›åº¦ç®¡ç†                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Utils                                  â”‚   â”‚
â”‚  â”‚  - SubtitleParser                                â”‚   â”‚
â”‚  â”‚  - TranscriptParser                              â”‚   â”‚
â”‚  â”‚  - GestureHandler                                â”‚   â”‚
â”‚  â”‚  - OrientationManager                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Repository                             â”‚   â”‚
â”‚  â”‚  - MediaRepository                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â†•                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Room Database                          â”‚   â”‚
â”‚  â”‚  - MediaItemDao                                  â”‚   â”‚
â”‚  â”‚  - CategoryDao                                   â”‚   â”‚
â”‚  â”‚  - PlaybackHistoryDao                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   External Services                      â”‚
â”‚  - ExoPlayer (Media3)                                   â”‚
â”‚  - MediaSessionService                                  â”‚
â”‚  - AudioManager                                         â”‚
â”‚  - WindowManager                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. ExoPlayerManager

**èŒè´£**ï¼šæ’­æ”¾å™¨æ ¸å¿ƒé€»è¾‘å°è£…

**ä¸»è¦åŠŸèƒ½**ï¼š
- æ’­æ”¾æ§åˆ¶ï¼ˆæ’­æ”¾ã€æš‚åœã€åœæ­¢ï¼‰
- è¿›åº¦ç®¡ç†ï¼ˆè·³è½¬ã€å‰è¿›ã€åé€€ï¼‰
- å€é€Ÿæ§åˆ¶ï¼ˆé¢„è®¾å€é€Ÿã€é•¿æŒ‰ä¸´æ—¶åŠ é€Ÿï¼‰
- çŠ¶æ€ç›‘å¬ï¼ˆæ’­æ”¾çŠ¶æ€ã€è¿›åº¦ã€æ—¶é•¿ï¼‰

**è®¾è®¡æ¨¡å¼**ï¼š
- **å•ä¾‹æ¨¡å¼**ï¼šå…¨å±€å…±äº«æ’­æ”¾å™¨å®ä¾‹
- **è§‚å¯Ÿè€…æ¨¡å¼**ï¼šä½¿ç”¨ StateFlow æš´éœ²çŠ¶æ€

**å…³é”®æ¥å£**ï¼š
```kotlin
interface PlaybackController {
    fun play()
    fun pause()
    fun seekTo(positionMs: Long)
    fun setPlaybackSpeed(speed: Float)
}
```

---

### 2. GestureHandler

**èŒè´£**ï¼šæ‰‹åŠ¿è¯†åˆ«ä¸å¤„ç†

**æ”¯æŒçš„æ‰‹åŠ¿**ï¼š
1. **å•å‡»**ï¼šæ˜¾ç¤º/éšè—æ§åˆ¶ç•Œé¢
2. **åŒå‡»**ï¼šå·¦ä¾§åé€€ / å³ä¾§å‰è¿›
3. **é•¿æŒ‰**ï¼šä¸´æ—¶ 2.5x åŠ é€Ÿ
4. **å‚ç›´æ»‘åŠ¨**ï¼šäº®åº¦ / éŸ³é‡è°ƒèŠ‚
5. **æ°´å¹³æ»‘åŠ¨**ï¼šå¿«è¿› / å¿«é€€

**è®¾è®¡æ¨¡å¼**ï¼š
- **ç­–ç•¥æ¨¡å¼**ï¼šä¸åŒæ‰‹åŠ¿ç±»å‹å¯¹åº”ä¸åŒå¤„ç†ç­–ç•¥

**å…³é”®ç®—æ³•**ï¼š
```kotlin
// åˆ¤æ–­æ»‘åŠ¨æ–¹å‘
fun isVerticalDrag(offset: Offset, startOffset: Offset): Boolean {
    val dx = abs(offset.x - startOffset.x)
    val dy = abs(offset.y - startOffset.y)
    return dy > dx && dy > 20f
}

// è®¡ç®—äº®åº¦å˜åŒ–
fun calculateBrightnessChange(
    currentBrightness: Float,
    dragAmount: Float,
    screenHeight: Float
): Float {
    val delta = -dragAmount / (screenHeight / 3f)
    return (currentBrightness + delta).coerceIn(0.01f, 1.0f)
}
```

---

### 3. SubtitleParser & TranscriptParser

**èŒè´£**ï¼šå­—å¹•å’Œæ–‡ç¨¿è§£æ

**æ”¯æŒæ ¼å¼**ï¼š
- SRT (SubRip)
- WebVTT
- è‡ªå®šä¹‰æ—¶é—´ç‚¹æ ¼å¼

**è§£ææµç¨‹**ï¼š
```
è¯»å–æ–‡ä»¶ â†’ æ­£åˆ™åŒ¹é… â†’ æ—¶é—´è½¬æ¢ â†’ æ¡ç›®ç”Ÿæˆ â†’ æ’åºç´¢å¼•
```

**æŸ¥è¯¢ç®—æ³•**ï¼š
```kotlin
// äºŒåˆ†æŸ¥æ‰¾å½“å‰å­—å¹•/æ–‡ç¨¿
fun getCurrentEntry(entries: List<Entry>, positionMs: Long): Entry? {
    return entries
        .filter { it.startTimeMs <= positionMs }
        .maxByOrNull { it.startTimeMs }
}
```

**æ—¶é—´å¤æ‚åº¦**ï¼šO(n) å¯ä¼˜åŒ–ä¸º O(log n)

---

### 4. MediaRepository

**èŒè´£**ï¼šæ•°æ®è®¿é—®ç»Ÿä¸€æ¥å£

**ç‰¹ç‚¹**ï¼š
- å°è£… Room DAO æ“ä½œ
- æä¾› Flow å“åº”å¼æ•°æ®æµ
- å¤„ç†æ•°æ®è½¬æ¢å’Œç¼“å­˜

**æ•°æ®æµå‘**ï¼š
```
ViewModel â†’ Repository â†’ DAO â†’ Database
              â†“
         ä¸šåŠ¡é€»è¾‘å¤„ç†
```

---

### 5. PlaybackService

**èŒè´£**ï¼šåå°æ’­æ”¾å’Œç³»ç»Ÿé›†æˆ

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- å‰å°æœåŠ¡ä¿æŒæ’­æ”¾
- MediaSession åª’ä½“æ§åˆ¶
- é€šçŸ¥æ æ˜¾ç¤ºå’Œäº¤äº’
- éŸ³é¢‘ç„¦ç‚¹ç®¡ç†

**ç”Ÿå‘½å‘¨æœŸ**ï¼š
```
åˆ›å»º â†’ ç»‘å®š MediaSession â†’ å¯åŠ¨å‰å°æœåŠ¡ â†’ æ’­æ”¾ â†’ åœæ­¢ â†’ é”€æ¯
```

---

## æ•°æ®æµè®¾è®¡

### æ’­æ”¾æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»æ’­æ”¾
    â†“
PlayerScreen è°ƒç”¨ ExoPlayerManager.prepareAndPlay()
    â†“
ExoPlayerManager å‡†å¤‡ MediaSource
    â†“
ExoPlayer å¼€å§‹æ’­æ”¾
    â†“
ExoPlayerManager æ›´æ–° StateFlow
    â†“
Compose UI å“åº”çŠ¶æ€å˜åŒ–é‡ç»„
```

### è¿›åº¦ä¿å­˜æµç¨‹

```
æ’­æ”¾è¿‡ç¨‹ä¸­å®šæœŸè§¦å‘
    â†“
ExoPlayerManager.getCurrentPositionMs()
    â†“
Repository.updatePlaybackPosition()
    â†“
MediaItemDao.updatePlaybackPosition()
    â†“
Room å†™å…¥æ•°æ®åº“
```

### æ‰‹åŠ¿å¤„ç†æµç¨‹

```
ç”¨æˆ·è§¦æ‘¸å±å¹•
    â†“
Compose pointerInput æ•è·äº‹ä»¶
    â†“
GestureHandler åˆ¤æ–­æ‰‹åŠ¿ç±»å‹
    â†“
æ‰§è¡Œå¯¹åº”æ“ä½œï¼ˆäº®åº¦/éŸ³é‡/è·³è½¬ï¼‰
    â†“
æ›´æ–° UI æŒ‡ç¤ºå™¨
```

---

## çŠ¶æ€ç®¡ç†

### StateFlow vs LiveData

æœ¬åº”ç”¨é€‰æ‹© **StateFlow** è€Œé LiveDataï¼š

**ä¼˜åŠ¿**ï¼š
- Kotlin åŸç”Ÿæ”¯æŒ
- æ›´å¥½çš„åç¨‹é›†æˆ
- ç±»å‹å®‰å…¨
- æ›´ç®€æ´çš„ API

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```kotlin
// ExoPlayerManager ä¸­
private val _isPlaying = MutableStateFlow(false)
val isPlaying: StateFlow<Boolean> = _isPlaying.asStateFlow()

// Compose ä¸­
val isPlaying by playerManager.isPlaying.collectAsState()
```

---

## çº¿ç¨‹æ¨¡å‹

### ä¸»çº¿ç¨‹
- UI æ¸²æŸ“
- ç”¨æˆ·äº¤äº’
- ExoPlayer å›è°ƒ

### åå°çº¿ç¨‹
- Room æ•°æ®åº“æ“ä½œï¼ˆè‡ªåŠ¨åœ¨åå°çº¿ç¨‹ï¼‰
- æ–‡ä»¶ I/Oï¼ˆå­—å¹•ã€æ–‡ç¨¿è§£æï¼‰
- ç½‘ç»œè¯·æ±‚ï¼ˆæœ¬åº”ç”¨ä¸ä½¿ç”¨ï¼‰

### åç¨‹è°ƒåº¦
```kotlin
// æ•°æ®åº“æ“ä½œ
viewModelScope.launch(Dispatchers.IO) {
    repository.updatePlaybackPosition(id, position)
}

// UI æ›´æ–°
viewModelScope.launch(Dispatchers.Main) {
    _uiState.value = newState
}
```

---

## å†…å­˜ç®¡ç†

### æ’­æ”¾å™¨èµ„æº
- ExoPlayer åœ¨ Activity.onDestroy() æ—¶é‡Šæ”¾
- é¿å…å†…å­˜æ³„æ¼ï¼šä½¿ç”¨ DisposableEffect

```kotlin
@Composable
fun PlayerScreen(playerManager: ExoPlayerManager) {
    DisposableEffect(Unit) {
        playerManager.initialize()
        onDispose {
            playerManager.release()
        }
    }
}
```

### æ•°æ®åº“è¿æ¥
- Room ä½¿ç”¨å•ä¾‹æ¨¡å¼
- è‡ªåŠ¨ç®¡ç†è¿æ¥æ± 

### Compose é‡ç»„ä¼˜åŒ–
- ä½¿ç”¨ `remember` ç¼“å­˜ç¨³å®šå¯¹è±¡
- ä½¿ç”¨ `derivedStateOf` é¿å…ä¸å¿…è¦çš„é‡ç»„
- é¿å…åœ¨ Composable ä¸­åˆ›å»ºæ–°å¯¹è±¡

---

## é”™è¯¯å¤„ç†

### åˆ†å±‚é”™è¯¯å¤„ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UI Layer: æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Domain Layer: è½¬æ¢ä¸ºä¸šåŠ¡é”™è¯¯          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Data Layer: æ•è·åº•å±‚å¼‚å¸¸              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…¸å‹é”™è¯¯åœºæ™¯

1. **æ–‡ä»¶æ— æ³•æ’­æ”¾**
```kotlin
try {
    playerManager.prepareAndPlay(uri)
} catch (e: Exception) {
    showError("æ— æ³•æ’­æ”¾æ­¤æ–‡ä»¶ï¼š${e.message}")
}
```

2. **æ•°æ®åº“æ“ä½œå¤±è´¥**
```kotlin
try {
    repository.insertMediaItem(item)
} catch (e: SQLiteException) {
    Log.e(TAG, "Database error", e)
    showError("ä¿å­˜å¤±è´¥")
}
```

3. **æƒé™è¢«æ‹’ç»**
```kotlin
if (!hasStoragePermission()) {
    requestPermission()
    return
}
```

---

## æ€§èƒ½ä¼˜åŒ–

### 1. æ’­æ”¾æ€§èƒ½
- ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿ
- é¢„åŠ è½½ç¼“å†²
- é€‚å½“çš„ç¼“å†²ç­–ç•¥

```kotlin
ExoPlayer.Builder(context)
    .setLoadControl(
        DefaultLoadControl.Builder()
            .setBufferDurationsMs(
                minBufferMs = 2500,
                maxBufferMs = 10000,
                bufferForPlaybackMs = 1000,
                bufferForPlaybackAfterRebufferMs = 2500
            )
            .build()
    )
    .build()
```

### 2. UI æ€§èƒ½
- LazyColumn è™šæ‹ŸåŒ–åˆ—è¡¨
- é¿å…è¿‡åº¦é‡ç»„
- ä½¿ç”¨ key ç¨³å®šåˆ—è¡¨é¡¹

### 3. æ•°æ®åº“æ€§èƒ½
- æ·»åŠ ç´¢å¼•
- æ‰¹é‡æ“ä½œ
- åˆ†é¡µåŠ è½½

```kotlin
@Query("SELECT * FROM media_items ORDER BY addedTime DESC LIMIT :limit OFFSET :offset")
suspend fun getMediaItemsPaged(limit: Int, offset: Int): List<MediaItem>
```

---

## æ‰©å±•æ€§è®¾è®¡

### æ’ä»¶åŒ–å­—å¹•æ”¯æŒ

```kotlin
interface SubtitleProvider {
    fun canParse(uri: Uri): Boolean
    fun parse(uri: Uri): List<SubtitleEntry>
}

class SrtSubtitleProvider : SubtitleProvider { ... }
class WebVttSubtitleProvider : SubtitleProvider { ... }
class AssSubtitleProvider : SubtitleProvider { ... }

class SubtitleManager {
    private val providers = listOf(
        SrtSubtitleProvider(),
        WebVttSubtitleProvider(),
        AssSubtitleProvider()
    )
    
    fun parse(uri: Uri): List<SubtitleEntry> {
        return providers.firstOrNull { it.canParse(uri) }
            ?.parse(uri)
            ?: emptyList()
    }
}
```

### æ’­æ”¾åˆ—è¡¨æ”¯æŒ

```kotlin
@Entity
data class Playlist(
    @PrimaryKey(autoGenerate = true)
    val id: Long = 0,
    val name: String,
    val mediaIds: List<Long>  // ä½¿ç”¨ TypeConverter
)

class PlaylistManager {
    fun createPlaylist(name: String): Long
    fun addToPlaylist(playlistId: Long, mediaId: Long)
    fun playNext(): MediaItem?
    fun playPrevious(): MediaItem?
}
```

---

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- ExoPlayerManager æ ¸å¿ƒé€»è¾‘
- SubtitleParser / TranscriptParser è§£æé€»è¾‘
- GestureHandler è®¡ç®—é€»è¾‘

### é›†æˆæµ‹è¯•
- Room DAO æ•°æ®åº“æ“ä½œ
- Repository æ•°æ®æµ

### UI æµ‹è¯•
- Compose ç»„ä»¶æ¸²æŸ“
- ç”¨æˆ·äº¤äº’æµç¨‹

---

## å®‰å…¨è€ƒè™‘

### 1. æ–‡ä»¶è®¿é—®
- ä½¿ç”¨ SAF (Storage Access Framework)
- æŒä¹…åŒ– URI æƒé™
- ä¸ç›´æ¥è®¿é—®æ–‡ä»¶è·¯å¾„

### 2. æ•°æ®éšç§
- æ‰€æœ‰æ•°æ®æœ¬åœ°å­˜å‚¨
- æ— ç½‘ç»œä¼ è¾“
- æ— ç¬¬ä¸‰æ–¹ SDK

### 3. æƒé™æœ€å°åŒ–
- ä»…è¯·æ±‚å¿…è¦æƒé™
- è¿è¡Œæ—¶æƒé™æ£€æŸ¥
- ä¼˜é›…çš„æƒé™æ‹’ç»å¤„ç†

---

## æœªæ¥æ”¹è¿›æ–¹å‘

### åŠŸèƒ½æ‰©å±•
1. æ’­æ”¾åˆ—è¡¨ç®¡ç†
2. å‡è¡¡å™¨æ”¯æŒ
3. è§†é¢‘æ»¤é•œ
4. æŠ•å±åŠŸèƒ½ï¼ˆDLNAï¼‰
5. äº‘åŒæ­¥è¿›åº¦ï¼ˆå¯é€‰ï¼‰

### æ€§èƒ½ä¼˜åŒ–
1. å›¾ç‰‡ç¼“å­˜ä¼˜åŒ–
2. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
3. å†…å­˜å ç”¨ä¼˜åŒ–
4. å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–

### ç”¨æˆ·ä½“éªŒ
1. ä¸»é¢˜è‡ªå®šä¹‰
2. æ‰‹åŠ¿è‡ªå®šä¹‰
3. æ›´å¤šåŠ¨ç”»æ•ˆæœ
4. æ— éšœç¢æ”¯æŒ

---

## å‚è€ƒèµ„æ–™

- [ExoPlayer å®˜æ–¹æ–‡æ¡£](https://developer.android.com/guide/topics/media/exoplayer)
- [Jetpack Compose æ–‡æ¡£](https://developer.android.com/jetpack/compose)
- [Room æŒä¹…åŒ–åº“](https://developer.android.com/training/data-storage/room)
- [Kotlin Coroutines](https://kotlinlang.org/docs/coroutines-overview.html)

---

**æ¶æ„è®¾è®¡ä»¥ç®€å•ã€å¯ç»´æŠ¤ã€å¯æ‰©å±•ä¸ºæ ¸å¿ƒåŸåˆ™ã€‚** ğŸ—ï¸

