# 测试指南

本文档提供详细的测试步骤和预期结果。

## 测试环境

- **最低 SDK**: API 26 (Android 8.0)
- **目标 SDK**: API 34 (Android 14)
- **推荐设备**: Android 10+ 的真机设备

## 功能测试清单

### 1. 基础播放测试

#### 测试步骤：
1. 打开应用
2. 点击 "+" 按钮导入视频文件
3. 点击媒体项开始播放
4. 点击播放/暂停按钮
5. 拖动进度条到不同位置
6. 点击前进/后退按钮

#### 预期结果：
- ✅ 视频正常播放，画面流畅
- ✅ 播放/暂停切换正常
- ✅ 进度条拖动后立即跳转到指定位置
- ✅ 前进/后退 15 秒功能正常
- ✅ 显示正确的当前时间和总时长

---

### 2. 倍速播放测试

#### 测试步骤：
1. 播放视频
2. 点击倍速按钮
3. 依次选择 0.75x, 1.0x, 1.25x, 1.5x, 1.75x, 2.0x, 2.5x, 3.0x
4. 观察播放速度变化
5. 长按屏幕任意位置
6. 松开屏幕

#### 预期结果：
- ✅ 每个倍速都能正确生效
- ✅ 倍速切换后音画同步正常
- ✅ 长按后立即切换到 2.5x
- ✅ 松开后恢复到长按前的倍速
- ✅ 屏幕显示 "2.5x 加速中" 提示

---

### 3. 手势控制测试

#### 双击快进/快退
**测试步骤：**
1. 播放视频
2. 双击屏幕左侧
3. 双击屏幕右侧

**预期结果：**
- ✅ 双击左侧后退 15 秒
- ✅ 双击右侧前进 15 秒
- ✅ 显示 "后退/前进 15 秒" 提示

#### 亮度调节
**测试步骤：**
1. 播放视频
2. 在屏幕左半侧向上滑动
3. 在屏幕左半侧向下滑动

**预期结果：**
- ✅ 向上滑动屏幕变亮
- ✅ 向下滑动屏幕变暗
- ✅ 显示亮度百分比提示

#### 音量调节
**测试步骤：**
1. 播放视频
2. 在屏幕右半侧向上滑动
3. 在屏幕右半侧向下滑动

**预期结果：**
- ✅ 向上滑动音量增大
- ✅ 向下滑动音量减小
- ✅ 显示音量百分比提示

---

### 4. 锁屏模式测试

#### 测试步骤：
1. 播放视频
2. 点击锁定按钮
3. 尝试点击屏幕
4. 尝试双击屏幕
5. 尝试滑动屏幕
6. 点击锁定图标解锁

#### 预期结果：
- ✅ 锁定后所有控制按钮隐藏
- ✅ 所有手势无效
- ✅ 仅显示锁定图标
- ✅ 点击锁定图标可解锁
- ✅ 解锁后恢复正常控制

---

### 5. 媒体库测试

#### 导入单个文件
**测试步骤：**
1. 点击 "+" 按钮
2. 选择"文档"
3. 选择一个视频文件
4. 返回媒体库

**预期结果：**
- ✅ 文件正确显示在列表中
- ✅ 显示文件名、时长

#### 导入文件夹
**测试步骤：**
1. 点击 "+" 按钮
2. 选择"使用此文件夹"
3. 选择包含多个媒体文件的文件夹
4. 授予权限
5. 返回媒体库

**预期结果：**
- ✅ 所有媒体文件都显示在列表中
- ✅ 支持子文件夹递归扫描

---

### 6. 播放进度保存测试

#### 测试步骤：
1. 播放视频到中间位置（如 50%）
2. 暂停播放
3. 返回媒体库
4. 再次点击该视频

#### 预期结果：
- ✅ 媒体库显示"已播放 50%"
- ✅ 再次打开从 50% 位置继续播放
- ✅ 进度自动保存（无需手动操作）

---

### 7. 屏幕方向测试

#### 横屏视频
**测试步骤：**
1. 播放宽高比 > 1 的视频（如 16:9）
2. 观察屏幕方向

**预期结果：**
- ✅ 自动切换到横屏模式

#### 竖屏视频
**测试步骤：**
1. 播放宽高比 < 1 的视频（如 9:16）
2. 观察屏幕方向

**预期结果：**
- ✅ 自动切换到竖屏模式

#### 音频文件
**测试步骤：**
1. 播放音频文件
2. 观察屏幕方向

**预期结果：**
- ✅ 始终保持竖屏
- ✅ 显示音频封面或默认图标

---

### 8. 后台播放测试

#### 测试步骤：
1. 播放音频或视频
2. 按 Home 键切换到桌面
3. 查看通知栏
4. 点击通知栏的播放/暂停按钮
5. 返回应用

#### 预期结果：
- ✅ 切换到后台后音频继续播放
- ✅ 通知栏显示媒体信息
- ✅ 通知栏控制按钮正常工作
- ✅ 返回应用后播放状态一致

#### 耳机控制测试
**测试步骤：**
1. 连接有线耳机或蓝牙耳机
2. 播放音频
3. 按耳机上的播放/暂停按钮

**预期结果：**
- ✅ 耳机控制正常响应
- ✅ 播放/暂停/上一首/下一首都能正常工作

---

### 9. 字幕测试

#### SRT 字幕
**测试文件示例 (test.srt):**
```
1
00:00:01,500 --> 00:00:04,000
这是第一条字幕

2
00:00:05,000 --> 00:00:08,000
这是第二条字幕
```

**测试步骤：**
1. 创建 SubtitleParser 实例
2. 调用 parseSrt() 解析字幕文件
3. 播放视频，调用 getCurrentSubtitle() 获取当前字幕
4. 在 UI 上显示字幕

**预期结果：**
- ✅ 正确解析所有字幕条目
- ✅ 字幕在正确的时间显示
- ✅ 字幕在正确的时间消失
- ✅ 多行字幕正确显示

---

### 10. 稿件时间点测试

#### 测试文件示例 (transcript.txt):
```
[00:00:10] 开场白：欢迎收看本期节目
[00:01:30] 第一章节：项目介绍
[00:05:00] 第二章节：功能演示
[00:10:00] 总结
```

**测试步骤：**
1. 创建 TranscriptManager 实例
2. 调用 load() 加载稿件文件
3. 显示稿件列表
4. 点击某个时间点
5. 播放时观察高亮状态

**预期结果：**
- ✅ 正确解析所有时间点
- ✅ 点击时间点跳转到对应位置
- ✅ 播放时自动高亮当前文本
- ✅ 滚动列表自动跟随当前位置

---

## 性能测试

### 内存测试
1. 使用 Android Profiler 监控内存使用
2. 连续播放多个视频
3. 检查是否有内存泄漏

**预期结果：**
- 内存使用稳定
- 无明显内存泄漏
- 切换媒体时正确释放资源

### 流畅度测试
1. 播放高清视频（1080p 或 4K）
2. 观察播放流畅度
3. 切换倍速
4. 拖动进度条

**预期结果：**
- 播放流畅，无卡顿
- 倍速切换无明显延迟
- 进度条拖动响应迅速

---

## 兼容性测试

### 测试设备列表
- Android 8.0 (API 26)
- Android 10 (API 29)
- Android 11 (API 30)
- Android 12 (API 31)
- Android 13 (API 33)
- Android 14 (API 34)

### 测试要点
- 权限申请流程
- SAF 文件访问
- 通知显示
- 后台播放

---

## 边界情况测试

### 1. 空列表
- 打开应用，媒体库为空
- 应显示提示信息

### 2. 文件不存在
- 删除已导入的媒体文件
- 尝试播放
- 应显示错误提示

### 3. 网络断开
- 完全断开网络连接
- 使用所有功能
- 应完全正常工作（因为完全离线）

### 4. 长时间播放
- 播放长视频（2 小时以上）
- 观察是否正常
- 检查进度保存是否正确

### 5. 快速操作
- 快速点击多个按钮
- 快速切换倍速
- 快速拖动进度条
- 应不会崩溃或出现异常

---

## 自动化测试

### 单元测试示例

```kotlin
@Test
fun testSubtitleParser() {
    val parser = SubtitleParser()
    val srt = """
        1
        00:00:01,500 --> 00:00:04,000
        Test subtitle
    """.trimIndent()
    
    val entries = parser.parseSrt(srt.byteInputStream())
    
    assertEquals(1, entries.size)
    assertEquals(1500L, entries[0].startTimeMs)
    assertEquals(4000L, entries[0].endTimeMs)
    assertEquals("Test subtitle", entries[0].text)
}
```

### UI 测试示例

```kotlin
@Test
fun testPlaybackControls() {
    composeTestRule.setContent {
        PlayerScreen(viewModel, playerManager)
    }
    
    // 点击播放按钮
    composeTestRule.onNodeWithContentDescription("播放").performClick()
    
    // 验证状态变化
    // ...
}
```

---

## 报告 Bug

如果发现问题，请提供以下信息：

1. **设备信息**
   - 设备型号
   - Android 版本
   - 应用版本

2. **复现步骤**
   - 详细的操作步骤
   - 预期结果
   - 实际结果

3. **日志信息**
   - Logcat 日志
   - 崩溃堆栈（如果有）

4. **媒体文件信息**（如果相关）
   - 文件格式
   - 文件大小
   - 编码信息

---

**测试人员**: ___________  
**测试日期**: ___________  
**测试版本**: v1.0.0  
**测试结果**: [ ] 通过  [ ] 不通过

